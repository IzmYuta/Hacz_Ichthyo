displayName: "High Resource Usage Alert"
documentation:
  content: "Alert when CPU or memory usage exceeds 80%"
  mimeType: "text/markdown"
conditions:
  - displayName: "CPU usage condition"
    conditionThreshold:
      filter: 'resource.type="cloud_run_revision" AND metric.type="run.googleapis.com/container/cpu/utilizations"'
      comparison: COMPARISON_GREATER_THAN
      thresholdValue: 0.8
      duration: 300s
      aggregations:
        - alignmentPeriod: 60s
          perSeriesAligner: ALIGN_MEAN
          crossSeriesReducer: REDUCE_MEAN
          groupByFields:
            - resource.label.service_name
  - displayName: "Memory usage condition"
    conditionThreshold:
      filter: 'resource.type="cloud_run_revision" AND metric.type="run.googleapis.com/container/memory/utilizations"'
      comparison: COMPARISON_GREATER_THAN
      thresholdValue: 0.8
      duration: 300s
      aggregations:
        - alignmentPeriod: 60s
          perSeriesAligner: ALIGN_MEAN
          crossSeriesReducer: REDUCE_MEAN
          groupByFields:
            - resource.label.service_name
combiner: OR
enabled: true
notificationChannels:
  - ${{ secrets.SLACK_WEBHOOK_URL }}
  - ${{ secrets.EMAIL_NOTIFICATION }}
alertStrategy:
  autoClose: 604800s
